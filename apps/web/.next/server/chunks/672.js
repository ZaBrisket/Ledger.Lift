exports.id=672,exports.ids=[672],exports.modules={4960:(e,t,s)=>{Promise.resolve().then(s.bind(s,85))},5435:(e,t,s)=>{Promise.resolve().then(s.t.bind(s,9515,23)),Promise.resolve().then(s.t.bind(s,9787,23)),Promise.resolve().then(s.t.bind(s,8039,23)),Promise.resolve().then(s.t.bind(s,2522,23)),Promise.resolve().then(s.t.bind(s,4689,23)),Promise.resolve().then(s.t.bind(s,4256,23))},85:(e,t,s)=>{"use strict";s.d(t,{default:()=>o});var r=s(4600),a=s(1201),i=s(5398);s(7449);let n=new a.S;function o({children:e}){return r.jsx(i.aH,{client:n,children:e})}},4346:(e,t,s)=>{"use strict";var r;function a(e){return new Promise(t=>setTimeout(t,e))}s.d(t,{xp:()=>m,WM:()=>p});class i extends Error{constructor(e,t,s,r){super(e),this.name="ApiError",this.code=t,this.status=s,this.details=r}}function n(e,t,s,r){return new i(e,t,s,r)}class o{on(e,t){return this.listeners[e]||(this.listeners[e]=[]),this.listeners[e].push(t),()=>{let s=this.listeners[e];if(s){let e=s.indexOf(t);e>-1&&s.splice(e,1)}}}emit(e,t){let s=this.listeners[e];s&&s.forEach(e=>e(t))}removeAllListeners(e){e?delete this.listeners[e]:this.listeners={}}constructor(){this.listeners={}}}let c=new o;async function l(e){let t=await e.arrayBuffer();return Array.from(new Uint8Array(await crypto.subtle.digest("SHA-256",t))).map(e=>e.toString(16).padStart(2,"0")).join("")}!function(e){e.CLOSED="closed",e.OPEN="open",e.HALF_OPEN="half-open"}(r||(r={}));class u{async execute(e){if("open"===this.state){if(Date.now()-this.lastFailureTime>this.recoveryTimeout)this.state="half-open";else throw n("Circuit breaker is open - service temporarily unavailable","CIRCUIT_OPEN")}try{let t=await e();return this.onSuccess(),t}catch(e){throw this.onFailure(),e}}onSuccess(){this.failureCount=0,this.state="closed"}onFailure(){this.failureCount++,this.lastFailureTime=Date.now(),this.failureCount>=this.failureThreshold&&(this.state="open")}getState(){return this.state}constructor(){this.state="closed",this.failureCount=0,this.lastFailureTime=0,this.failureThreshold=5,this.recoveryTimeout=3e4}}class h{constructor(){this.circuitBreaker=new u,this.defaultTimeout=3e4,this.uploadTimeout=12e4,this.baseUrl=process.env.NEXT_PUBLIC_API_URL||"http://localhost:8000"}getApiBase(){return this.baseUrl}async enhancedFetch(e,t={},s=this.defaultTimeout,r=3){let o=`${Date.now()}-${Math.random().toString(36).substr(2,9)}`,c=new AbortController,l=setTimeout(()=>c.abort(),s),u={...t,signal:c.signal,headers:{"Content-Type":"application/json","X-Request-ID":o,...t.headers}},h=n("Unknown error","UNKNOWN_ERROR");for(let t=0;t<r;t++)try{clearTimeout(l);let i=setTimeout(()=>c.abort(),s),d=await fetch(e,u);if(clearTimeout(i),d.ok)return d;let m=await d.text().catch(()=>"Unknown error"),p=n(`HTTP ${d.status}: ${m}`,"HTTP_ERROR",d.status,{requestId:o,attempt:t+1});if(d.status>=400&&d.status<500&&408!==d.status&&429!==d.status)throw p;if(h=p,t<r-1){let e=Math.min(1e3*Math.pow(2,t),1e4),s=1e3*Math.random();await a(e+s)}}catch(e){var d;if(clearTimeout(l),h=e instanceof i?e:e instanceof Error&&"AbortError"===e.name?n("Request timeout","TIMEOUT",408,{requestId:o,attempt:t+1,timeout:s}):n(e instanceof Error?e.message:"Network error","NETWORK_ERROR",void 0,{requestId:o,attempt:t+1}),!(t<r-1)||(!(d=h).status||d.status>=500||408===d.status||429===d.status?0:1))break;{let e=Math.min(1e3*Math.pow(2,t),1e4),s=1e3*Math.random();await a(e+s)}}throw h}async presignUpload(e,t,s){try{let r=await this.circuitBreaker.execute(async()=>{let r={filename:e,content_type:t};return void 0!==s&&(r.file_size=s),(await this.enhancedFetch(`${this.baseUrl}/v1/uploads/presign`,{method:"POST",body:JSON.stringify(r)})).json()});return{success:!0,data:r}}catch(t){let e=t instanceof i?t:n("Failed to presign upload","PRESIGN_ERROR");return console.error("Presign upload failed:",e),{success:!1,error:e}}}async registerDocument(e){try{let t=await this.circuitBreaker.execute(async()=>(await this.enhancedFetch(`${this.baseUrl}/v1/documents`,{method:"POST",body:JSON.stringify(e)})).json());return{success:!0,data:t}}catch(t){let e=t instanceof i?t:n("Failed to register document","REGISTER_ERROR");return console.error("Document registration failed:",e),{success:!1,error:e}}}async uploadFileToS3(e,t,s,r,a){try{return a||await l(t),c.emit("upload:start",{filename:t.name,size:t.size}),await this.circuitBreaker.execute(async()=>new Promise((a,i)=>{let o=new XMLHttpRequest;o.upload.onprogress=e=>{if(e.lengthComputable){let s=e.loaded/e.total*100;r&&(r.progress=s),c.emit("upload:progress",{progress:s,filename:t.name})}},o.onload=()=>{o.status>=200&&o.status<300?a():i(n(`S3 upload failed: ${o.status}`,"S3_UPLOAD_ERROR",o.status))},o.onerror=()=>{i(n("S3 upload network error","S3_NETWORK_ERROR"))},o.ontimeout=()=>{i(n("S3 upload timeout","S3_TIMEOUT",408))},o.open("PUT",e),o.setRequestHeader("Content-Type",s),o.timeout=this.uploadTimeout,o.send(t)})),c.emit("upload:success",{filename:t.name,documentId:""}),{success:!0}}catch(s){let e=s instanceof i?s:n("S3 upload failed","S3_UPLOAD_ERROR");return c.emit("upload:error",{filename:t.name,error:e}),console.error("S3 upload failed:",e),{success:!1,error:e}}finally{c.emit("upload:complete",{filename:t.name})}}async getDocument(e){try{let t=await this.circuitBreaker.execute(async()=>(await this.enhancedFetch(`${this.baseUrl}/v1/documents/${e}`)).json());return{success:!0,data:t}}catch(e){return{success:!1,error:e instanceof i?e:n("Failed to get document","GET_DOCUMENT_ERROR")}}}async getHealth(){try{let e=await this.enhancedFetch(`${this.baseUrl}/health`,{},5e3,1),t=await e.json();return{success:!0,data:t}}catch(e){return{success:!1,error:e instanceof i?e:n("Health check failed","HEALTH_CHECK_ERROR")}}}async uploadFile(e,t){try{if(!e)throw n("No file provided","VALIDATION_ERROR");let s=await l(e),r=await this.presignUpload(e.name,e.type,e.size);if(!r.success)return r;let a=await this.uploadFileToS3(r.data.presigned_url,e,e.type,t,s);if(!a.success)return a;let i=await this.registerDocument({s3_key:r.data.s3_key,original_filename:e.name,content_type:e.type,file_size:e.size,sha256_hash:s});if(!i.success)return i;return c.emit("upload:success",{filename:e.name,documentId:i.data.id}),{success:!0,documentId:i.data.id}}catch(s){let t=s instanceof i?s:n("File upload failed","UPLOAD_ERROR");return c.emit("upload:error",{filename:e.name,error:t}),{success:!1,error:t}}}getCircuitBreakerStatus(){return{state:this.circuitBreaker.getState(),isHealthy:"closed"===this.circuitBreaker.getState()}}}let d=new h;async function m(e,t){let s=await d.presignUpload(e,t);if(s.success)return s.data;throw Error(s.error.message)}async function p(e){let t=await d.registerDocument(e);if(t.success)return t.data;throw Error(t.error.message)}},2732:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>u,metadata:()=>l});var r=s(2719);s(2124),s(74);var a=s(4560);let i=(0,a.createProxy)(String.raw`/workspace/apps/web/src/lib/Providers.tsx`),{__esModule:n,$$typeof:o}=i;i.default;let c=(0,a.createProxy)(String.raw`/workspace/apps/web/src/lib/Providers.tsx#default`),l={title:"Ledger Lift",description:"Upload PDFs â†’ data extraction"};function u({children:e}){return r.jsx("html",{lang:"en",children:r.jsx("body",{children:r.jsx(c,{children:e})})})}},74:()=>{}};